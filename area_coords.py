"""日本の主要市区町村の代表座標（内蔵データ）"""

AREA_COORDS: dict[str, tuple[float, float]] = {
    # 北海道
    "札幌市中央区": (43.0621, 141.3544), "札幌市北区": (43.0898, 141.3402),
    "札幌市東区": (43.0783, 141.3826), "札幌市西区": (43.0785, 141.3138),
    "札幌市豊平区": (43.0474, 141.3750), "札幌市厚別区": (43.0351, 141.4281),
    "札幌市手稲区": (43.1149, 141.2615), "札幌市清田区": (42.9986, 141.4067),
    "函館市": (41.7686, 140.7290), "旭川市": (43.7707, 142.3650),
    "釧路市": (42.9849, 144.3820), "帯広市": (42.9236, 143.1960),
    "留萌市": (43.9410, 141.6400), "石狩市": (43.1665, 141.3162),
    "小樽市": (43.1907, 141.0020), "室蘭市": (42.3150, 140.9740),
    "伊達市": (42.4726, 140.8686), "千歳市": (42.8219, 141.6522),
    "苫小牧市": (42.6340, 141.6050), "岩見沢市": (43.1958, 141.7761),
    # 岩手
    "盛岡市": (39.7036, 141.1527),
    # 山形
    "天童市": (38.3627, 140.3780),
    # 宮城
    "仙台市青葉区": (38.2688, 140.8721), "仙台市宮城野区": (38.2719, 140.9048),
    "名取市": (38.1731, 140.8913),
    # 福島
    "郡山市": (37.4011, 140.3877), "いわき市": (36.9404, 140.8880),
    # 新潟
    "新潟市江南区": (37.8609, 139.1200),
    # 石川
    "金沢市": (36.5944, 136.6256),
    # 栃木
    "宇都宮市": (36.5651, 139.8836), "栃木市": (36.3795, 139.7234),
    "佐野市": (36.2265, 139.5781), "足利市": (36.3401, 139.4497),
    "小山市": (36.3147, 139.8004), "鹿沼市": (36.5614, 139.7415),
    # 茨城
    "水戸市": (36.3418, 140.4469), "つくば市": (36.0832, 140.0776),
    "古河市": (36.1825, 139.7064), "結城市": (36.3061, 139.8681),
    "常陸大宮市": (36.5413, 140.4132), "鉾田市": (36.0857, 140.5296),
    # 群馬
    "前橋市": (36.3906, 139.0607), "高崎市": (36.3228, 139.0033),
    "伊勢崎市": (36.3108, 139.1972), "太田市": (36.2918, 139.3763),
    "桐生市": (36.4047, 139.3327), "館林市": (36.2456, 139.5395),
    "富岡市": (36.2661, 138.8887), "みどり市": (36.3932, 139.2767),
    "藤岡市": (36.2528, 139.0749), "安中市": (36.3252, 138.8912),
    "渋川市": (36.4907, 138.9965), "吾妻郡東吾妻町": (36.5575, 138.8132),
    "北群馬郡吉岡町": (36.4618, 139.0123),
    # 埼玉
    "さいたま市大宮区": (35.9063, 139.6234), "さいたま市浦和区": (35.8577, 139.6480),
    "さいたま市北区": (35.9280, 139.6234), "さいたま市緑区": (35.8403, 139.6762),
    "さいたま市見沼区": (35.9159, 139.6564),
    "所沢市": (35.7998, 139.4690), "春日部市": (35.9754, 139.7527),
    "川越市": (35.9253, 139.4856), "越谷市": (35.8904, 139.7900),
    "川口市": (35.8077, 139.7244), "三郷市": (35.8307, 139.8639),
    "入間市": (35.8355, 139.3916), "久喜市": (36.0607, 139.6682),
    "富士見市": (35.8558, 139.5494), "朝霞市": (35.7978, 139.5939),
    "深谷市": (36.1990, 139.2804), "熊谷市": (36.1465, 139.3888),
    "行田市": (36.1389, 139.4568), "北本市": (36.0238, 139.5272),
    "東松山市": (36.0429, 139.4001), "羽生市": (36.1762, 139.5540),
    "北葛飾郡杉戸町": (36.0243, 139.7285), "児玉郡上里町": (36.2418, 139.1830),
    # 千葉
    "浦安市": (35.6549, 139.8981), "千葉市美浜区": (35.6449, 140.0535),
    "千葉市中央区": (35.6074, 140.1064), "千葉市稲毛区": (35.6459, 140.0766),
    "千葉市花見川区": (35.6685, 140.0576),
    "船橋市": (35.6951, 139.9838), "柏市": (35.8682, 139.9757),
    "松戸市": (35.7878, 139.9025), "市川市": (35.7220, 139.9310),
    "流山市": (35.8569, 139.9035), "成田市": (35.7775, 140.3187),
    "木更津市": (35.3757, 139.9264), "市原市": (35.5043, 140.1159),
    "印旛郡酒々井町": (35.7208, 140.3128), "印西市": (35.8275, 140.1447),
    "我孫子市": (35.8636, 140.0282),
    # 東京
    "足立区": (35.7745, 139.8045), "葛飾区": (35.7476, 139.8471),
    "墨田区": (35.7120, 139.8015), "江戸川区": (35.7069, 139.8677),
    "江東区": (35.6728, 139.8176), "港区": (35.6581, 139.7514),
    "中央区": (35.6703, 139.7725), "千代田区": (35.6940, 139.7533),
    "台東区": (35.7126, 139.7814), "文京区": (35.7078, 139.7519),
    "新宿区": (35.6938, 139.7036), "渋谷区": (35.6617, 139.7041),
    "品川区": (35.6094, 139.7303), "目黒区": (35.6320, 139.6982),
    "大田区": (35.5614, 139.7161), "世田谷区": (35.6465, 139.6534),
    "中野区": (35.7075, 139.6640), "杉並区": (35.6994, 139.6361),
    "豊島区": (35.7281, 139.7181), "北区": (35.7529, 139.7335),
    "板橋区": (35.7507, 139.7100), "練馬区": (35.7361, 139.6524),
    "武蔵野市": (35.7176, 139.5661), "三鷹市": (35.6839, 139.5598),
    "調布市": (35.6516, 139.5455), "町田市": (35.5430, 139.4459),
    "多摩市": (35.6369, 139.4460), "八王子市": (35.6664, 139.3160),
    "立川市": (35.6981, 139.4133), "西東京市": (35.7255, 139.5374),
    "日野市": (35.6710, 139.3957), "東大和市": (35.7444, 139.4265),
    "国分寺市": (35.7009, 139.4624), "青梅市": (35.7882, 139.2755),
    "西多摩郡日の出町": (35.7524, 139.2614),
    # 神奈川
    "横浜市西区": (35.4658, 139.6225), "横浜市中区": (35.4437, 139.6380),
    "横浜市神奈川区": (35.4840, 139.6230), "横浜市港北区": (35.5440, 139.6280),
    "横浜市青葉区": (35.5604, 139.5349), "横浜市金沢区": (35.3741, 139.6260),
    "横浜市旭区": (35.4895, 139.5683), "横浜市泉区": (35.4232, 139.5290),
    "横浜市保土ヶ谷区": (35.4671, 139.5862), "横浜市磯子区": (35.4005, 139.6316),
    "横浜市港南区": (35.4025, 139.6000), "横浜市都筑区": (35.5374, 139.5701),
    "横浜市鶴見区": (35.5038, 139.6789),
    "川崎市川崎区": (35.5309, 139.6990), "川崎市幸区": (35.5449, 139.6813),
    "川崎市中原区": (35.5711, 139.6567), "川崎市高津区": (35.5875, 139.6437),
    "相模原市南区": (35.5374, 139.3720), "相模原市中央区": (35.5718, 139.3730),
    "相模原市緑区": (35.6130, 139.3986),
    "鎌倉市": (35.3196, 139.5467), "藤沢市": (35.3375, 139.4888),
    "横須賀市": (35.2809, 139.6690), "平塚市": (35.3262, 139.3507),
    "大和市": (35.4552, 139.4600), "海老名市": (35.4449, 139.3905),
    "厚木市": (35.4410, 139.3623), "中巨摩郡昭和町": (35.6198, 138.5186),
    # 山梨
    "中巨摩郡昭和町": (35.6198, 138.5186),
    # 長野
    "長野市": (36.6513, 138.1810), "松本市": (36.2380, 137.9720),
    "上田市": (36.4018, 138.2494), "佐久市": (36.2487, 138.4761),
    "岡谷市": (36.0620, 137.9997), "小諸市": (36.3301, 138.4258),
    "須坂市": (36.6519, 138.3059),
    # 静岡
    "御殿場市": (35.3085, 138.9338), "静岡市葵区": (34.9769, 138.3831),
    "浜松市中央区": (34.7108, 137.7261), "沼津市": (35.0956, 138.8632),
    "磐田市": (34.7177, 137.8510), "駿東郡小山町": (35.3649, 138.9836),
    "浜松市浜名区": (34.7481, 137.6511),
    # 岐阜
    "本巣市": (35.5063, 136.6802), "各務原市": (35.3997, 136.8486),
    "関市": (35.4965, 136.9143),
    # 愛知
    "名古屋市中村区": (35.1706, 136.8820), "名古屋市中区": (35.1652, 136.9038),
    "名古屋市東区": (35.1793, 136.9284), "名古屋市港区": (35.0942, 136.8791),
    "名古屋市昭和区": (35.1501, 136.9138), "名古屋市熱田区": (35.1244, 136.8999),
    "名古屋市南区": (35.1121, 136.9244), "名古屋市名東区": (35.1867, 137.0007),
    "日進市": (35.1327, 137.0302), "常滑市": (34.8837, 136.8305),
    "長久手市": (35.1817, 137.0497), "安城市": (34.9570, 137.0820),
    "岡崎市": (34.9483, 137.1742), "豊橋市": (34.7690, 137.3915),
    "一宮市": (35.3079, 136.8009), "西春日井郡豊山町": (35.2503, 136.9107),
    "愛知郡東郷町": (35.0907, 137.0551), "豊田市": (35.0837, 137.1560),
    # 三重
    "津市": (34.7181, 136.5083), "鈴鹿市": (34.8810, 136.5840),
    "員弁郡東員町": (35.0499, 136.6109),
    # 滋賀
    "草津市": (35.0144, 135.9611),
    # 京都
    "京都市下京区": (34.9942, 135.7553), "京都市中京区": (35.0116, 135.7681),
    "京都市北区": (35.0516, 135.7522), "京都市東山区": (34.9934, 135.7831),
    "京都市南区": (34.9733, 135.7453), "京都市左京区": (35.0359, 135.7761),
    "城陽市": (34.8666, 135.7829), "木津川市": (34.7785, 135.8264),
    # 大阪
    "大阪市北区": (34.7055, 135.4983), "大阪市中央区": (34.6864, 135.5093),
    "大阪市淀川区": (34.7283, 135.4929), "大阪市天王寺区": (34.6547, 135.5160),
    "大阪市浪速区": (34.6636, 135.5022), "大阪市阿倍野区": (34.6442, 135.5155),
    "大阪市西成区": (34.6356, 135.4931), "大阪市都島区": (34.7094, 135.5239),
    "大阪市鶴見区": (34.6869, 135.5740), "大阪市城東区": (34.6958, 135.5481),
    "大阪市東淀川区": (34.7457, 135.5266), "大阪市旭区": (34.7226, 135.5551),
    "大阪市平野区": (34.6541, 135.5497), "大阪市西淀川区": (34.7090, 135.4655),
    "大阪市此花区": (34.6882, 135.4499), "大阪市西区": (34.6793, 135.4893),
    "守口市": (34.7330, 135.5616), "門真市": (34.7201, 135.5879),
    "東大阪市": (34.6795, 135.5998), "八尾市": (34.6267, 135.5999),
    "四條畷市": (34.7253, 135.6379), "高槻市": (34.8491, 135.6171),
    "枚方市": (34.8133, 135.6528), "吹田市": (34.7604, 135.5161),
    "茨木市": (34.8161, 135.5680), "池田市": (34.8284, 135.4393),
    "豊中市": (34.7813, 135.4699), "寝屋川市": (34.7639, 135.6323),
    "堺市北区": (34.6046, 135.4810), "堺市堺区": (34.5795, 135.4826),
    "堺市南区": (34.5403, 135.4901), "堺市西区": (34.5578, 135.4369),
    "岸和田市": (34.4554, 135.3629), "和泉市": (34.4857, 135.4285),
    "藤井寺市": (34.5730, 135.5994), "羽曳野市": (34.5527, 135.5991),
    "河内長野市": (34.4574, 135.5640), "泉南市": (34.3617, 135.3418),
    "泉南郡田尻町": (34.3997, 135.4085),
    # 和歌山
    "和歌山市": (34.2261, 135.1676),
    # 奈良
    "奈良市": (34.6851, 135.8050), "橿原市": (34.5069, 135.7949),
    "大和郡山市": (34.6513, 135.7880), "大和高田市": (34.5232, 135.7367),
    "北葛城郡王寺町": (34.5799, 135.7090),
    # 兵庫
    "神戸市中央区": (34.6913, 135.1956), "神戸市東灘区": (34.7208, 135.2687),
    "神戸市垂水区": (34.6317, 135.0738), "神戸市北区": (34.7588, 135.1417),
    "神戸市西区": (34.6758, 135.0601),
    "西宮市": (34.7372, 135.3408), "尼崎市": (34.7331, 135.4063),
    "宝塚市": (34.7993, 135.3605), "川西市": (34.8285, 135.4153),
    "明石市": (34.6451, 134.9977), "加古川市": (34.7570, 134.8407),
    "姫路市": (34.8159, 134.6853), "三田市": (34.8893, 135.2261),
    "たつの市": (34.8576, 134.5437),
    # 岡山
    "岡山市北区": (34.6617, 133.9350),
    # 広島
    "広島市中区": (34.3853, 132.4553), "広島市南区": (34.3701, 132.4587),
    "廿日市市": (34.3493, 132.3228), "安芸郡府中町": (34.3879, 132.5114),
    # 香川
    "綾歌郡綾川町": (34.2435, 133.9210),
    # 愛媛
    "伊予郡松前町": (33.8551, 132.7248),
    # 高知
    "高知市": (33.5597, 133.5311),
    # 福岡
    "福岡市中央区": (33.5902, 130.3981), "福岡市博多区": (33.5903, 130.4207),
    "久留米市": (33.3190, 130.5083), "北九州市小倉北区": (33.8839, 130.8783),
    "北九州市八幡東区": (33.8691, 130.8187), "筑紫野市": (33.5230, 130.5094),
    "福津市": (33.7746, 130.4860),
    # 佐賀
    "佐賀市": (33.2635, 130.3008),
    # 長崎
    "長崎市": (32.7503, 129.8777),
    # 熊本
    "熊本市中央区": (32.8031, 130.7079), "熊本市東区": (32.8101, 130.7558),
    "菊池郡菊陽町": (32.8604, 130.7904), "菊池郡大津町": (32.8773, 130.8716),
    "上益城郡嘉島町": (32.7379, 130.7463),
    # 鹿児島
    "鹿児島市": (31.5966, 130.5571),
    # 沖縄
    "浦添市": (26.2456, 127.7220), "中頭郡北中城村": (26.2872, 127.8041),
}

import math

def haversine(lat1: float, lng1: float, lat2: float, lng2: float) -> float:
    R = 6371.0
    dlat = math.radians(lat2 - lat1)
    dlng = math.radians(lng2 - lng1)
    a = (math.sin(dlat / 2) ** 2
         + math.cos(math.radians(lat1)) * math.cos(math.radians(lat2))
         * math.sin(dlng / 2) ** 2)
    return R * 2 * math.asin(math.sqrt(a))


def get_nearby_areas(lat: float, lng: float, radius_km: float = 10.0) -> list[str]:
    """指定座標から radius_km 以内の登録エリア名リストを返す"""
    result = []
    for area, (alat, alng) in AREA_COORDS.items():
        if haversine(lat, lng, alat, alng) <= radius_km:
            result.append(area)
    return result


def get_station_coord(name: str) -> tuple[float, float] | None:
    """駅名・地名から座標を返す（部分一致）"""
    # 内蔵の主要駅データ
    STATIONS: dict[str, tuple[float, float]] = {
        "矢向": (35.5271, 139.6598),
        "鶴見": (35.5096, 139.6791),
        "川崎": (35.5309, 139.6990),
        "横浜": (35.4658, 139.6225),
        "新宿": (35.6896, 139.7006),
        "渋谷": (35.6580, 139.7016),
        "池袋": (35.7295, 139.7109),
        "品川": (35.6284, 139.7388),
        "上野": (35.7141, 139.7774),
        "東京": (35.6812, 139.7671),
        "新橋": (35.6664, 139.7584),
        "有楽町": (35.6752, 139.7631),
        "秋葉原": (35.6984, 139.7731),
        "神田": (35.6919, 139.7706),
        "大宮": (35.9063, 139.6234),
        "浦和": (35.8577, 139.6480),
        "武蔵小杉": (35.5750, 139.6599),
        "溝の口": (35.5864, 139.6212),
        "吉祥寺": (35.7027, 139.5797),
        "三鷹": (35.6839, 139.5598),
        "立川": (35.6981, 139.4133),
        "八王子": (35.6664, 139.3160),
        "町田": (35.5430, 139.4459),
        "梅田": (34.7055, 135.4983),
        "難波": (34.6659, 135.5014),
        "天王寺": (34.6547, 135.5160),
        "三宮": (34.6913, 135.1956),
        "名古屋": (35.1706, 136.8820),
        "栄": (35.1652, 136.9038),
        "金山": (35.1318, 136.8984),
        "博多": (33.5903, 130.4207),
        "天神": (33.5902, 130.3981),
        "仙台": (38.2688, 140.8721),
        "札幌": (43.0621, 141.3544),
        "広島": (34.3853, 132.4553),
        "岡山": (34.6617, 133.9350),
        "熊本": (32.8031, 130.7079),
        "鹿児島中央": (31.5966, 130.5571),
        "那覇": (26.2122, 127.6791),
        "京都": (34.9858, 135.7588),
        "大阪": (34.7028, 135.4960),
        "新大阪": (34.7338, 135.5002),
        "心斎橋": (34.6756, 135.5002),
        "恵比寿": (35.6467, 139.7101),
        "目黒": (35.6330, 139.7157),
        "五反田": (35.6260, 139.7237),
        "大森": (35.5796, 139.7364),
        "蒲田": (35.5635, 139.7165),
        "二子玉川": (35.6097, 139.6272),
        "自由が丘": (35.6073, 139.6681),
        "北千住": (35.7484, 139.8028),
        "亀有": (35.7637, 139.8499),
        "新小岩": (35.7132, 139.8631),
        "錦糸町": (35.6961, 139.8155),
        "両国": (35.7013, 139.7948),
        "門前仲町": (35.6728, 139.7985),
        "大手町": (35.6862, 139.7631),
        "丸の内": (35.6812, 139.7671),
        "六本木": (35.6627, 139.7312),
        "青山": (35.6698, 139.7167),
        "表参道": (35.6654, 139.7120),
        "原宿": (35.6702, 139.7026),
        "代々木": (35.6836, 139.7023),
        "初台": (35.6822, 139.6949),
        "笹塚": (35.6756, 139.6716),
        "明大前": (35.6709, 139.6493),
        "下高井戸": (35.6671, 139.6375),
        "千歳烏山": (35.6647, 139.6097),
        "仙川": (35.6604, 139.5860),
        "柴崎": (35.6563, 139.5712),
        "国領": (35.6539, 139.5596),
        "布田": (35.6525, 139.5518),
        "調布": (35.6516, 139.5455),
        "西調布": (35.6498, 139.5321),
        "飛田給": (35.6484, 139.5219),
        "武蔵野台": (35.6481, 139.5127),
        "多磨霊園": (35.6484, 139.5005),
        "東府中": (35.6491, 139.4884),
        "府中": (35.6545, 139.4813),
        "分倍河原": (35.6567, 139.4625),
        "中河原": (35.6584, 139.4477),
        "聖蹟桜ヶ丘": (35.6384, 139.4330),
        "豊田": (35.6565, 139.4073),
        "日野": (35.6710, 139.3957),
        "高幡不動": (35.6654, 139.4029),
        "南大沢": (35.6037, 139.4260),
        "橋本": (35.5831, 139.3624),
        "相模大野": (35.5350, 139.4499),
        "本厚木": (35.4410, 139.3623),
        "海老名": (35.4449, 139.3905),
        "大船": (35.3143, 139.5334),
        "鎌倉": (35.3196, 139.5467),
        "逗子": (35.2946, 139.5716),
        "横須賀": (35.2809, 139.6690),
        "追浜": (35.3154, 139.6564),
        "上大岡": (35.4005, 139.6000),
        "戸塚": (35.3977, 139.5341),
        "大和": (35.4552, 139.4600),
        "藤沢": (35.3375, 139.4888),
        "茅ヶ崎": (35.3326, 139.4043),
        "平塚": (35.3262, 139.3507),
        "二宮": (35.3013, 139.2529),
        "小田原": (35.2567, 139.1551),
    }

    # 完全一致
    clean = name.replace("駅", "").strip()
    if clean in STATIONS:
        return STATIONS[clean]

    # 部分一致
    for k, v in STATIONS.items():
        if clean in k or k in clean:
            return v

    return None
